#!/bin/sh

if ! grep -q 'AUTO-GENERATED' "$HOME/.ssh/config" 1>/dev/null 2>&1
then
    mkdir -p "$HOME/.ssh/config.d"
    test -e "$HOME/.ssh/config" && mv "$HOME/.ssh/config" "$HOME/.ssh/config.d/99local_ssh.config"
fi

echo "# AUTO-GENERATED" > "$HOME/.ssh/config"
echo "# This file is auto-generated by '$0' from the contents of '~/.ssh/config.d/*.config', do not edit." >> "$HOME/.ssh/config"
echo "# If you wish to change your SSH configuration, add a '[name].config' file in '~/.ssh/config.d/'." >> "$HOME/.ssh/config"

if [ -d "$HOME/.ssh/config.d" ]; then
    for f in `ls -1 $HOME/.ssh/config.d/*.config`; do
	echo        >> "$HOME/.ssh/config"
	echo "# $f" >> "$HOME/.ssh/config"
	cat "$f"    >> "$HOME/.ssh/config"
    done
fi
